{
  "name": "e2e-tests",
  "version": "1.0.0",
  "license": "Apache-2.0",
  "description": "SkillTree Dashboard and Client Display End to End Tests",
  "author": "SkillTree Team",
  "main": "index.js",
  "config": {
    "dbHost": "localhost",
    "dbName": "skills"
  },
  "scripts": {
    "printDb": "echo DB Host = [$npm_package_config_dbHost], DB Name = [$npm_package_config_dbName]",
    "preinstall": "npm run stop-only && npm run verifyMathImageSnapshotIsNotUsed",
    "licenseDepCheck": "license-checker --production --onlyAllow='MIT;ISC;Apache-2.0;0BSD;BSD-2-Clause;BSD-3-Clause;WTFPL;Unlicense' --summary",
    "licenseHeaderCheck": "license-check-and-add check -f '../license-add/license-add-config.json'",
    "licenseHeaderAdd": "license-check-and-add add -f ../license-add/license-add-config.json",
    "licenseCheck": "npm run licenseHeaderCheck && npm run licenseDepCheck",
    "verifyMathImageSnapshotIsNotUsed": "if find cypress/e2e/ -type f  -exec grep -in \"matchImageSnapshot\" {} + ; then exit -1; else exit 0; fi",
    "verifyThatNewSnapshotsAreNotCreated": "if git status | grep \"cypress/snapshots\" ; then exit -1; else exit 0; fi",
    "stop-only": "stop-only --folder 'cypress/e2e'",
    "cy:open": "TZ=UTC cypress open --env visualRegressionType=base",
    "cy:open:oauth": "TZ=UTC cypress open --env oauthMode=true,visualRegressionType=base",
    "cy:open:dev": "TZ=UTC cypress open --config baseUrl=http://localhost:5173 --env visualRegressionType=base",
    "cy:open:devEST": "TZ=EST cypress open --config baseUrl=http://localhost:5173 --env visualRegressionType=base",
    "cy:open:dev:oauth": "TZ=UTC cypress open --config baseUrl=http://localhost:5173 --env oauthMode=true,visualRegressionType=base",
    "cy:open:dev:verifyEmail": "TZ=UTC cypress open --config baseUrl=http://localhost:5173 --env verifyEmail=true,visualRegressionType=base",
    "cy:run": "TZ=UTC  cypress run --browser chrome --config video=true --env visualRegressionType=regression",
    "cy:run:oauth": "TZ=UTC  cypress run --browser chrome --env oauthMode=true --config video=true",
    "cy:run:accessibility": "TZ=UTC  cypress run --browser chrome --env enableLighthouse=true,enableAvgLighthouseScore=true --browser chrome --headless --spec \"cypress/e2e/accessibility/*.js\" --config video=true",
    "cy:run:dev": "TZ=UTC cypress run --browser chrome --config baseUrl=http://localhost:5173  --env visualRegressionType=base",
    "cy:run:dev:specificTest": "TZ=UTC cypress run --browser chrome --config baseUrl=http://localhost:5173 --spec \"cypress/e2e/client-display/client-display-theme-components_spec.js\" --env visualRegressionType=base",
    "cy:run:dev:updateSnapshotForSpecificTests": "TZ=UTC cypress run --browser chrome --env visualRegressionType=base --config baseUrl=http://localhost:5173 --spec \"cypress/e2e/metrics/skillMetrics_spec.js\"",
    "cy:run:dev:metrics": "TZ=UTC cypress run --browser chrome --spec \"cypress/e2e/metrics/projectMetrics_projects_spec.js,cypress/e2e/metrics/projectMetrics_subjects_spec.js,cypress/e2e/metrics/skillMetrics_spec.js,cypress/e2e/metrics/subjectMetrics_spec.js\"",
    "cy:run:dev:updateAdminSnapshots": "TZ=UTC cypress run --browser chrome --config baseUrl=http://localhost:5173  --env visualRegressionType=base --spec \"cypress/e2e/skills_group_spec.js,cypress/e2e/markdown_spec.j\"",
    "cy:run:dev:updateMetricsSnapshots": "TZ=UTC cypress run --browser chrome --config baseUrl=http://localhost:5173  --env visualRegressionType=base --spec \"cypress/e2e/metrics/projectMetrics_projects_spec.js,cypress/e2e/metrics/projectMetrics_subjects_spec.js,cypress/e2e/metrics/skillMetrics_spec.js,cypress/e2e/metrics/subjectMetrics_spec.js\"",
    "cy:run:dev:updateClientDisplaySnapshots": "TZ=UTC cypress run --browser chrome --config baseUrl=http://localhost:5173 --env visualRegressionType=base --spec \"cypress/e2e/client-display/client-display-theme_spec.js,cypress/e2e/client-display/client-display_spec.js,cypress/e2e/client-display/client-display-search-skills_spec.js,cypress/e2e/client-display/client-display-theme-components_spec.js,cypress/e2e/client-display/client-display_point_history_chart_spec.js,cypress/e2e/client-display/client-display-self_report_skills_spec.js,cypress/e2e/client-display/client-display-markdown_spec.js,cypress/e2e/client-display/client-display_point_history_chart_spec.js,cypress/e2e/client-display/client-display_leaderboard_spec.js,cypress/e2e/client-display/client-display_leaderboard_sharedData_spec.js,cypress/e2e/client-display/skills-display-prerequisites_spec.js,cypress/e2e/client-display/client-display_catalog_skills_spec.js,cypress/e2e/client-display/skills-display-badge-bonus_spec.js,cypress/e2e/client-display/client-display-skills_filtering_spec.js,cypress/e2e/client-display/client-display-theme-various-display-sizes_spec.js,cypress/e2e/client-display/skills-display-achieved-date_spec.js\"",
    "cy:run:dev:updateLearningPathSnapshots": "TZ=UTC cypress run --browser chrome --config baseUrl=http://localhost:5173 --env visualRegressionType=base --spec \"cypress/e2e/learning-path/client-display-learning-path-graph-snapshots_spec.js,cypress/e2e/learning-path/client-display-learning-path-graph-theme-snapshots_spec.js\"",
    "cy:run:dev:clientDisplay": "TZ=UTC cypress run --browser chrome --config baseUrl=http://localhost:5173 --env visualRegressionType=base --spec \"cypress/e2e/client-display/*.js\"",
    "cy:run:dev:learningPath": "TZ=UTC cypress run --browser chrome --config baseUrl=http://localhost:5173 --env visualRegressionType=base --spec \"cypress/e2e/learning-path/*.js\"",
    "cy:run:dev:quiz": "TZ=UTC cypress run --browser chrome --config baseUrl=http://localhost:5173 --env customSnapshotsDir=./cypress/snapshots/quiz --spec \"cypress/e2e/quiz/client-display_quiz_visual_spec.js\"",
    "cy:run:dev:updateQuizSnapshots": "TZ=UTC cypress run --browser chrome --config baseUrl=http://localhost:5173 --env visualRegressionType=base --spec \"cypress/e2e/quiz/client-display_quiz_visual_spec.js,cypress/e2e/quiz/client-display_quiz_theme_spec.js\"",
    "cy:run:dev:updateSnapshots": "npm run cy:run:dev:updateClientDisplaySnapshots && npm run cy:run:dev:updateLearningPathSnapshots && npm run cy:run:dev:updateQuizSnapshots && npm run cy:run:dev:updateAdminSnapshots && npm run cy:run:dev:updateMetricsSnapshots",
    "cy:run:dev:accessibility": "TZ=UTC cypress run --browser chrome --env enableLighthouse=true --headless --config baseUrl=http://localhost:5173 --spec cypress/e2e/accessibility/accessibility_quiz_specs.js",
    "cy:run:dev:oauth": "TZ=UTC cypress run --browser chrome --config baseUrl=http://localhost:5173 --env oauthMode=true",
    "cy:verify": "cypress verify",
    "backend:start": "java -Dspring.datasource.url=jdbc:postgresql://$npm_package_config_dbHost:5432/$npm_package_config_dbName -Dspring.config.location=classpath:/application.yml,file:serverConfigs/backend_application.properties -jar ../service/target/skills-service-*.jar",
    "backend:start:verifyEmail": "java -Dspring.config.location=classpath:/application.yml,file:serverConfigs/backend_application.properties -Dskills.authorization.verifyEmailAddresses=true -jar ../service/target/skills-service-*.jar",
    "backend:start:rabbitmq": "java -Dspring.config.location=classpath:/application.yml,file:serverConfigs/backend_application.properties -Dskills.websocket.enableStompBrokerRelay=true -Dskills.websocket.relayHost=localhost -Dlogging.level.org.springframework.web.socket=TRACE -jar ../service/target/skills-service-*.jar ",
    "backend:start:oauth": "java -Dspring.config.location=classpath:/application.yml,file:serverConfigs/backend_application.properties,file:serverConfigs/backend_oauth_application.properties -jar ../service/target/skills-service-*.jar ",
    "backend:start:ci": "mkdir -p ./logs && npm run backend:start > ./logs/skills-service.out &",
    "backend:start:verifyEmail:ci": "mkdir -p ./logs && npm run backend:start:verifyEmail > ./logs/skills-service.out &",
    "backend:start:oauth:ci": "mkdir -p ./logs && npm run backend:start:oauth > ./logs/skills-service.out &",
    "backend:start:rabbitmq:ci": "mkdir -p ./logs && npm run backend:start:rabbitmq > ./logs/skills-service.out &",
    "backend:waitToStart": "echo \"Started waiting for skills-service at [$(date)]\" && npx wait-on -t 160000 http://localhost:8080",
    "backend:resetDb": "export PGPASSWORD=skillsPassword && psql -U postgres -h $npm_package_config_dbHost -d $npm_package_config_dbName -f ./cypress/db/reset.sql",
    "backend:clearDb": "export PGPASSWORD=skillsPassword && psql -U postgres -h $npm_package_config_dbHost -d $npm_package_config_dbName -f ./cypress/db/clear.sql",
    "backend:setupInviteOnly": "export PGPASSWORD=skillsPassword && psql -U postgres -h $npm_package_config_dbHost -d $npm_package_config_dbName -f ./cypress/db/createInviteOnlyProject.sql",
    "backend:countScheduledTasks": "export PGPASSWORD=skillsPassword && psql -U postgres -h $npm_package_config_dbHost -d $npm_package_config_dbName -f ./cypress/db/countScheduledTasks.sql",
    "backend:dropAllDBTables": "export PGPASSWORD=skillsPassword && psql -U postgres -h $npm_package_config_dbHost -d $npm_package_config_dbName -f ./cypress/db/dropTables.sql",
    "client-display:serve": "cd ../client-display && npm prune && npm install && npm run serve",
    "client-display:serve:ci": "mkdir -p ./logs && npm run client-display:serve > ./logs/client-display.out &",
    "client-display:serve:ci:oauth": "mkdir -p ./logs && VUE_APP_AUTHENTICATION_URL=hydra npm run client-display:serve > ./logs/client-display.out &",
    "client-display:waitToStart": "npx wait-on -t 160000 http://localhost:8083",
    "cyServices:start:skills-service": "npm run backend:start:ci && npm run backend:waitToStart",
    "cyServices:start:skills-service:verifyEmail": "npm run fake-smtp:start:ci &&  npm run backend:start:verifyEmail:ci && npm run backend:waitToStart",
    "cyServices:start:skills-service:oauth": "npm run fake-smtp:start:ci &&  npm run backend:start:oauth:ci && npm run backend:waitToStart",
    "cyServices:start:skills-service:rabbitmq": "npm run fake-smtp:start:ci &&  npm run backend:start:rabbitmq:ci && npm run backend:waitToStart",
    "cyServices:start:client-display": "npm run client-display:serve:ci && npm run client-display:waitToStart",
    "cyServices:start:client-display:oauth": "npm run client-display:serve:ci:oauth && npm run client-display:waitToStart",
    "cyServices:start": "npm run cyServices:start:skills-service && npm run fake-smtp:start:ci",
    "cyServices:kill:skills-service": "for procid in $(ps -aux | grep \"serverConfigs/.*properties\" | grep \"jar$\" | awk '{print $2}'); do echo \"killing skills-service ${procid}\"; kill -9 $procid; done",
    "cyServices:kill:client-display": "for procid in $(ps -aux | grep \"client-display\" | grep \"serve\" | grep -v \"grep\" | awk '{print $2}'); do echo \"killing skills-display ${procid}\"; kill -9 $procid; done",
    "cyServices:kill:client-display:1": "for procid in $(ps -aux | grep \"client-display\" | grep \"vue-cli-service serve\" | grep -v \"grep\" | awk '{print $2}'); do echo \"killing skills-display  ${procid}\"; kill -9 $procid; done",
    "cyServices:kill": "npm run cyServices:kill:skills-service && npm run cyServices:kill:client-display && npm run cyServices:kill:client-display:1 && npm run fake-smtp:stop",
    "print-env": "print-env",
    "fake-smtp:start": "docker run -p 1080:1080 -p 1025:1025 --restart unless-stopped maildev/maildev",
    "fake-smtp:start:ci": "mkdir -p ./logs && nohup npm run fake-smtp:start > ./logs/fake-smtp.log &",
    "fake-smtp:stop": "fuser -k 1081/tcp"
  },
  "devDependencies": {
    "@bahmutov/print-env": "2.1.2",
    "axe-core": "4.8.4",
    "badge-maker": "3.3.1",
    "cypress": "13.9.0",
    "cypress-audit": "1.1.0",
    "cypress-axe": "1.5.0",
    "cypress-file-upload": "5.0.8",
    "cypress-plugin-tab": "1.0.5",
    "cypress-real-events": "1.12.0",
    "cypress-visual-regression": "5.0.0",
    "cypress-wait-until": "3.0.1",
    "dayjs": "1.10.4",
    "eslint": "7.9.0",
    "license-check-and-add": "4.0.5",
    "license-checker": "25.0.1",
    "moment": "2.29.4",
    "moment-timezone": "0.5.45",
    "number-format.js": "2.0.9",
    "object-scan": "14.0.0",
    "pdf-parse": "1.1.1",
    "stop-only": "3.3.1",
    "wait-on": "5.2.1"
  },
  "dependencies": {
    "idb-keyval": "6.2.1"
  }
}
